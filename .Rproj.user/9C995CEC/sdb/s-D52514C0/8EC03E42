{
    "collab_server" : "",
    "contents" : "library(\"waterData\")\nlibrary(\"lubridate\")\nlibrary(\"ggplot2\")\nlibrary(\"tidyverse\")\nlibrary(\"scales\")\nlibrary(\"dplyr\")\nlibrary(\"shiny\")\nlibrary(\"shinythemes\")\nlibrary(\"reshape\")\n\n\nstation = '02323500'   \n\n#get site name to use in plot titles and such\nstinfo  = siteInfo(station)\n\n#read entire time series\ndis   = importDVs(staid=station,code='00060',stat='00003', sdate= \"1950-01-01\") \n\ndis$year    = as.numeric(strftime(dis$dates,format=\"%Y\"))\n#dis$month   = as.numeric(strftime(dis$dates,format=\"%m\")) \n\n#Naming columns, using the Diver sensors, collects date, pressure, temp, conductivity\ncolnames(dis) <- c(\"StaID\", \"Discharge\", \"oldDate\", \"QualCode\", \"Year\")\n\ndis$Date2 = as.Date(dis$oldDate,\"%m/%d/%Y\")\n\ndis2 = subset(dis, substr(dis$Date2,6,10)!='02-29') \n\nout = matrix(NA,365,5)   # Object to fill with the loop - quantiles for every day of the year\nday = unique(paste(substr(dis2$Date2[],6,7),substr(dis2$Date2[],9,10),sep='-'))  # Unique days of the year\no=order(day,decreasing = FALSE)\t\t\t\t# index for reordering day \ndays=day[o]                           # order days  \n\nlength(days)   # Check \n\nfor(i in 1:length(days)){\n  ind = which(substr(dis2$Date2[],6,10)==days[i])\n  out[i,] = quantile(dis2[ind,][,2], na.rm=TRUE)\n}\n\nhead(out)    \n\n\n\nout2 = melt(out)\nhead(out2)\ncolnames(out2) = list(\"id\",\"variable\",\"value\")\nout2$variable = factor(out2$variable, levels=c(\"1\",\"2\",\"3\",\"4\",\"5\"))\nstr(out2)\n\n# ------------------ Format the individual years of data --------------------- #\n# Subset years for plotting \n\n\ndis_50 =subset(dis2, substr(dis2$Date,1,4)=='1950')\ndis_51 =subset(dis2, substr(dis2$Date,1,4)=='1951')\ndis_52 =subset(dis2, substr(dis2$Date,1,4)=='1952')\ndis_53 =subset(dis2, substr(dis2$Date,1,4)=='1953')\ndis_54 =subset(dis2, substr(dis2$Date,1,4)=='1954')\ndis_55 =subset(dis2, substr(dis2$Date,1,4)=='1955')\ndis_56 =subset(dis2, substr(dis2$Date,1,4)=='1956')\ndis_57 =subset(dis2, substr(dis2$Date,1,4)=='1957')\ndis_58 =subset(dis2, substr(dis2$Date,1,4)=='1958')\ndis_59 =subset(dis2, substr(dis2$Date,1,4)=='1959')\ndis_60 =subset(dis2, substr(dis2$Date,1,4)=='1960')\ndis_61 =subset(dis2, substr(dis2$Date,1,4)=='1961')\ndis_62 =subset(dis2, substr(dis2$Date,1,4)=='1962')\ndis_63 =subset(dis2, substr(dis2$Date,1,4)=='1963')\ndis_64 =subset(dis2, substr(dis2$Date,1,4)=='1964')\ndis_65 =subset(dis2, substr(dis2$Date,1,4)=='1965')\ndis_66 =subset(dis2, substr(dis2$Date,1,4)=='1966')\ndis_67 =subset(dis2, substr(dis2$Date,1,4)=='1967')\ndis_68 =subset(dis2, substr(dis2$Date,1,4)=='1968')\ndis_69 =subset(dis2, substr(dis2$Date,1,4)=='1969')\ndis_70 =subset(dis2, substr(dis2$Date,1,4)=='1970')\ndis_71 =subset(dis2, substr(dis2$Date,1,4)=='1971')\ndis_72 =subset(dis2, substr(dis2$Date,1,4)=='1972')\ndis_73 =subset(dis2, substr(dis2$Date,1,4)=='1973')\ndis_74 =subset(dis2, substr(dis2$Date,1,4)=='1974')\ndis_75 =subset(dis2, substr(dis2$Date,1,4)=='1975')\ndis_76 =subset(dis2, substr(dis2$Date,1,4)=='1976')\ndis_77 =subset(dis2, substr(dis2$Date,1,4)=='1977')\ndis_78 =subset(dis2, substr(dis2$Date,1,4)=='1978')\ndis_79 =subset(dis2, substr(dis2$Date,1,4)=='1979')\ndis_80 =subset(dis2, substr(dis2$Date,1,4)=='1980')\ndis_81 =subset(dis2, substr(dis2$Date,1,4)=='1981')\ndis_82 =subset(dis2, substr(dis2$Date,1,4)=='1982')\ndis_83 =subset(dis2, substr(dis2$Date,1,4)=='1983')\ndis_84 =subset(dis2, substr(dis2$Date,1,4)=='1984')\ndis_85 =subset(dis2, substr(dis2$Date,1,4)=='1985')\ndis_86 =subset(dis2, substr(dis2$Date,1,4)=='1986')\ndis_87 =subset(dis2, substr(dis2$Date,1,4)=='1987')\ndis_88 =subset(dis2, substr(dis2$Date,1,4)=='1988')\ndis_89 =subset(dis2, substr(dis2$Date,1,4)=='1989')\ndis_90 =subset(dis2, substr(dis2$Date,1,4)=='1990')\ndis_91 =subset(dis2, substr(dis2$Date,1,4)=='1991')\ndis_92 =subset(dis2, substr(dis2$Date,1,4)=='1992')\ndis_93 =subset(dis2, substr(dis2$Date,1,4)=='1993')\ndis_94 =subset(dis2, substr(dis2$Date,1,4)=='1994')\ndis_95 =subset(dis2, substr(dis2$Date,1,4)=='1995')\ndis_96 =subset(dis2, substr(dis2$Date,1,4)=='1996')\ndis_97 =subset(dis2, substr(dis2$Date,1,4)=='1997')\ndis_98 =subset(dis2, substr(dis2$Date,1,4)=='1998')\ndis_99 =subset(dis2, substr(dis2$Date,1,4)=='1999')\ndis_00 =subset(dis2, substr(dis2$Date,1,4)=='2000')\ndis_01 =subset(dis2, substr(dis2$Date,1,4)=='2001')\ndis_02 =subset(dis2, substr(dis2$Date,1,4)=='2002')\ndis_03 =subset(dis2, substr(dis2$Date,1,4)=='2003')\ndis_04 =subset(dis2, substr(dis2$Date,1,4)=='2004')\ndis_05 =subset(dis2, substr(dis2$Date,1,4)=='2005')\ndis_06 =subset(dis2, substr(dis2$Date,1,4)=='2006')\ndis_07 =subset(dis2, substr(dis2$Date,1,4)=='2007')\ndis_08 =subset(dis2, substr(dis2$Date,1,4)=='2008')\ndis_09 =subset(dis2, substr(dis2$Date,1,4)=='2009')\ndis_10 =subset(dis2, substr(dis2$Date,1,4)=='2010')\ndis_11 =subset(dis2, substr(dis2$Date,1,4)=='2011')\ndis_07 =subset(dis2, substr(dis2$Date,1,4)=='2007')\ndis_08 =subset(dis2, substr(dis2$Date,1,4)=='2008')\ndis_09 =subset(dis2, substr(dis2$Date,1,4)=='2009')\ndis_10 =subset(dis2, substr(dis2$Date,1,4)=='2010')\ndis_11 =subset(dis2, substr(dis2$Date,1,4)=='2011')\ndis_12 =subset(dis2, substr(dis2$Date,1,4)=='2012')\ndis_13 =subset(dis2, substr(dis2$Date,1,4)=='2013')\ndis_14 =subset(dis2, substr(dis2$Date,1,4)=='2014')\ndis_15 =subset(dis2, substr(dis2$Date,1,4)=='2015')\ndis_16 =subset(dis2, substr(dis2$Date,1,4)=='2016')\ndis_17 =subset(dis2, substr(dis2$Date,1,4)=='2017')\n\n\nlength(dis_07$Date)    # Check \nlength(dis_08$Date)     \nlength(dis_09$Date)\nlength(dis_10$Date)\nlength(dis_11$Date)\n\ndis3 <- as.data.frame(cbind(dis_50$Discharge,dis_51$Discharge,dis_52$Discharge,dis_53$Discharge,dis_54$Discharge,dis_55$Discharge,dis_56$Discharge,dis_57$Discharge,dis_58$Discharge,dis_59$Discharge,\n                            dis_60$Discharge, dis_61$Discharge,dis_62$Discharge,dis_63$Discharge,dis_64$Discharge,dis_65$Discharge,dis_66$Discharge,dis_67$Discharge,dis_68$Discharge,dis_69$Discharge,\n                            dis_70$Discharge, dis_71$Discharge,dis_72$Discharge,dis_73$Discharge,dis_74$Discharge,dis_75$Discharge,dis_76$Discharge,dis_77$Discharge,dis_78$Discharge,dis_79$Discharge,\n                            dis_80$Discharge, dis_81$Discharge, dis_82$Discharge,dis_83$Discharge,dis_84$Discharge,dis_85$Discharge,dis_86$Discharge,dis_87$Discharge,dis_88$Discharge,dis_89$Discharge,\n                            dis_90$Discharge, dis_91$Discharge, dis_92$Discharge,dis_93$Discharge,dis_94$Discharge,dis_95$Discharge,dis_96$Discharge,dis_97$Discharge,dis_98$Discharge,dis_99$Discharge,\n                            dis_00$Discharge, dis_01$Discharge, dis_02$Discharge,dis_03$Discharge,dis_04$Discharge,dis_05$Discharge,dis_06$Discharge,dis_07$Discharge,dis_08$Discharge,dis_09$Discharge,\n                            dis_10$Discharge,dis_11$Discharge,dis_12$Discharge, dis_13$Discharge,dis_14$Discharge,dis_15$Discharge,dis_16$Discharge,dis_17$Discharge))\n\nclass(dis3)\nhead(dis3)\n\ncolnames(dis3) = list(\"D1950\",\"D1951\",\"D1952\",\"D1953\",\"D1954\",\"D1955\",\"D1956\",\"D1957\",\"D1958\",\"D1959\",\"D1960\",\n                      \"D1961\",\"D1962\",\"D1963\",\"D1964\",\"D1965\",\"D1966\",\"D1967\",\"D1968\",\"D1969\",\"D1970\",\n                      \"D1971\",\"D1972\",\"D1973\",\"D1974\",\"D1975\",\"D1976\",\"D1977\",\"D1978\",\"D1979\",\"D1980\",\n                      \"D1981\",\"D1982\",\"D1983\",\"D1984\",\"D1985\",\"D1986\",\"D1987\",\"D1988\",\"D1989\",\"D1990\",\n                      \"D1991\",\"D1992\",\"D1993\",\"D1994\",\"D1995\",\"D1996\",\"D1997\",\"D1998\",\"D1999\",\"D2000\",\n                      \"D2001\",\"D2002\",\"D2003\",\"D2004\",\"D2005\",\"D2006\",\"D2007\",\"D2008\",\"D2009\",\n                      \"D2010\",\n                      \"D2011\", \"D2012\", \"D2013\", \"D2014\", \"D2015\", \"D2016\", \"D2017\")\n# Combine discharge with quantile data\ndis4 = cbind(dis3,out2)\nstr(dis4)\nhead(dis4)\n\n\n\ndis<- read.csv (\"dis.csv\", header=T)\ndis$Date <- as.Date(dis$oldDate)\n\n# Define UI for application that draws a histogram\nui <- fluidPage(theme = shinytheme(\"yeti\"),\n                \n   \n   # Application title\n   \n   h3(\"River Discharge Comparison\"),\n   \n   sidebarLayout(\n     sidebarPanel(\n       selectInput(\"year1\", label= h4(\"Year\"), \n                   choices=unique(dis$Year), selected= \"2002\"),\n       \n       selectInput(\"year2\", label= h4(\"Comparison Year\"), \n                   choices=unique(dis$Year), selected= \"2012\"),\n       \n       \n       radioButtons(\"type\", \"Plot type\", choices =c (\"Linear\"= \"line\",\n                                                     \"Boxplot\" = \"box\"), \n                    selected = \"line\")\n     \n       ),\n       \n     \n      # Show a plot of the generated distribution\n      mainPanel(\n         plotOutput(\"rd\")\n         \n    )\n   )\n  )\n\n\n\n# Define server logic required to draw a histogram\nserver <- function(input, output, session) {\n  \n  rd <- reactive({\n    \n    dis <- dis %>% \n      filter(Year == input$year1|Year == input$year2)\n\n  \n    if(input$type == \"line\") { \n    ggplot(data=dis, aes(x= Date, y=Discharge/1000)) + \n      geom_line() + \n      scale_x_date(\n        breaks = date_breaks(\"1 month\") ,\n        labels = date_format(\"%b\")) +\n      theme(panel.border = element_rect(color = \"black\", size = 0.5, fill = NA, linetype=\"solid\"),axis.text.x = element_text(angle = 90, hjust = 1, size=12)) +\n      labs(x=\"Month\", y=\"River Discharge (1,000 cfs)\") +\n      facet_wrap(~Year, ncol=1, scale = \"free_x\")\n      \n    }    else {\n      ggplot(data=dis, aes(x= Month, y=Discharge/1000)) + \n        geom_boxplot(position = 'identity') +\n        scale_x_discrete(\n          limits = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")) +\n        theme(panel.border = element_rect(color = \"black\", size = 0.5, fill = NA, linetype=\"solid\"),axis.text.x = element_text(angle = 90, hjust = 1, size=12)) +\n        labs(x=\"Month\", y=\"River Discharge (1,000 cfs)\") +\n        facet_wrap(~Year, ncol=1) \n    }\n    \n  })\n    \n\n  \n  output$rd <-renderPlot({rd()})\n\n  }\n\n\n# Run the application \nshinyApp(ui = ui, server = server)\n",
    "created" : 1528224289190.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "3388998030",
    "id" : "8EC03E42",
    "lastKnownWriteTime" : 1528224791,
    "last_content_update" : 1528224791575,
    "path" : "T:/Oyster Project/river_discharge/Flow summaries/River/river_dishcarge/app.R",
    "project_path" : "river_dishcarge/app.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}